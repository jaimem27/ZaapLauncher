<Window x:Class="ZaapLauncher.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ZaapLauncher"
        Width="1000"
        Height="600"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        Background="#0B1220"
        WindowStyle="None"
        AllowsTransparency="False"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType"
        TextOptions.TextHintingMode="Fixed"
        RenderOptions.BitmapScalingMode="HighQuality">

    <Window.Resources>

        <!-- Portal breath -->
        <Storyboard x:Key="PortalBreath" RepeatBehavior="Forever" AutoReverse="True">
            <DoubleAnimation Storyboard.TargetName="PortalBaseImage"
                             Storyboard.TargetProperty="Opacity"
                             From="0.90"
                             To="0.98"
                             Duration="0:0:3.5" />
        </Storyboard>

        <Storyboard x:Key="VortexLoop" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="SplashVortexRotate"
                             Storyboard.TargetProperty="Angle"
                             From="0"
                             To="360"
                             Duration="0:0:6" />
            <DoubleAnimation Storyboard.TargetName="SplashVortexScale"
                             Storyboard.TargetProperty="ScaleX"
                             From="1.04"
                             To="1.08"
                             Duration="0:0:1.6"
                             AutoReverse="True" />
            <DoubleAnimation Storyboard.TargetName="SplashVortexScale"
                             Storyboard.TargetProperty="ScaleY"
                             From="1.04"
                             To="1.08"
                             Duration="0:0:1.6"
                             AutoReverse="True" />
        </Storyboard>

        <!-- Pulse al volverse READY: NO lo usamos ahora (dejamos glow fijo + micro pulso por scale) -->
        <Storyboard x:Key="PlayReadyGlowPro">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.BlurRadius)"
                             To="30"
                             Duration="0:0:0.2"
                             AutoReverse="True" />
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.Opacity)"
                             To="1"
                             Duration="0:0:0.2"
                             AutoReverse="True" />
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.BlurRadius)"
                             To="18"
                             BeginTime="0:0:0.4"
                             Duration="0:0:0.2" />
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.Opacity)"
                             To="0.65"
                             BeginTime="0:0:0.4"
                             Duration="0:0:0.2" />
        </Storyboard>

        <Storyboard x:Key="PlayReadyGlowLoop" RepeatBehavior="Forever" AutoReverse="True">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.BlurRadius)"
                             From="16"
                             To="24"
                             Duration="0:0:1.2" />
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.Effect).(DropShadowEffect.Opacity)"
                             From="0.45"
                             To="0.75"
                             Duration="0:0:1.2" />
        </Storyboard>

        <Storyboard x:Key="HideSplash">
            <DoubleAnimation Storyboard.TargetName="SplashOverlay"
                             Storyboard.TargetProperty="Opacity"
                             To="0"
                             BeginTime="0:0:0.45"
                             Duration="0:0:0.40" />
            <DoubleAnimation Storyboard.TargetName="SplashScale"
                             Storyboard.TargetProperty="ScaleX"
                             To="5.0"
                             Duration="0:0:0.85"
                             AccelerationRatio="0.25"
                             DecelerationRatio="0.05" />
            <DoubleAnimation Storyboard.TargetName="SplashScale"
                             Storyboard.TargetProperty="ScaleY"
                             To="5.0"
                             Duration="0:0:0.85"
                             AccelerationRatio="0.25"
                             DecelerationRatio="0.05" />
            <DoubleAnimation Storyboard.TargetName="MainContent"
                             Storyboard.TargetProperty="Opacity"
                             To="1"
                             BeginTime="0:0:0.55"
                             Duration="0:0:0.35" />
            <DoubleAnimation Storyboard.TargetName="MainBlur"
                             Storyboard.TargetProperty="Radius"
                             To="0"
                             BeginTime="0:0:0.55"
                             Duration="0:0:0.35" />
        </Storyboard>

        <!-- Header typography -->
        <Style x:Key="HeaderTitleStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="/Fonts/#Exo 2" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="20" />
            <Setter Property="Foreground" Value="#F3F8FF" />
            <Setter Property="TextOptions.TextFormattingMode" Value="Display" />
        </Style>

        <Style x:Key="HeaderSubtitleStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#8FB0D6" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontFamily" Value="Segoe UI Variable Text" />
            <Setter Property="Opacity" Value="0.95" />
        </Style>

        <!-- Chip text -->
        <Style x:Key="HeaderChipText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#BFD6FF" />
            <Setter Property="FontSize" Value="10.5" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontFamily" Value="Segoe UI Variable Text" />
        </Style>

        <!-- Header icon buttons -->
        <Style x:Key="HeaderIconButton" TargetType="Button">
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="32" />
            <Setter Property="Background" Value="#0E1A2F" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1" />
                </Setter.Value>
            </Setter>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                CornerRadius="12"
                                Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#162747" />
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.04" ScaleY="1.04" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>

                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#0B1430" />
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Header close button (red hover) -->
        <Style x:Key="HeaderCloseButton"
               TargetType="Button"
               BasedOn="{StaticResource HeaderIconButton}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                CornerRadius="12"
                                Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#3A1B24" />
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.04" ScaleY="1.04" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>

                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#2A1119" />
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="HeaderActionButton" TargetType="Button">
            <Setter Property="Height" Value="32" />
            <Setter Property="Padding" Value="14,0" />
            <Setter Property="Background" Value="#0E1A2F" />
            <Setter Property="BorderBrush" Value="#1F2E52" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Foreground" Value="#BFD6FF" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                CornerRadius="999"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#162747" />
                                <Setter TargetName="Root" Property="BorderBrush" Value="#2D4B77" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#0B1430" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- PLAY button style -->
        <Style x:Key="PlayButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="210" />
            <Setter Property="Height" Value="60" />
            <Setter Property="Background" Value="#3B82F6" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1" />
                </Setter.Value>
            </Setter>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>

                            <!-- Outer glow (visible in hover + READY) -->
                            <Border x:Name="Glow"
                                    CornerRadius="20"
                                    Background="#1026C6FF"
                                    Opacity="0">
                                <Border.Effect>
                                    <DropShadowEffect Color="#7CFFB2"
                                                      BlurRadius="70"
                                                      ShadowDepth="0"
                                                      Opacity="1" />
                                </Border.Effect>
                            </Border>

                            <!-- Root -->
                            <Border x:Name="Root"
                                    CornerRadius="20"
                                    Background="{TemplateBinding Background}"
                                    BorderThickness="1"
                                    BorderBrush="#00000000"
                                    SnapsToDevicePixels="True">

                                <Grid ClipToBounds="True">

                                    <!-- Top sheen -->
                                    <Border CornerRadius="20"
                                            Opacity="0.16">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                <GradientStop Color="#FFFFFFFF" Offset="0" />
                                                <GradientStop Color="#00FFFFFF" Offset="1" />
                                            </LinearGradientBrush>
                                        </Border.Background>
                                    </Border>

                                    <!-- Diagonal highlight -->
                                    <Rectangle Opacity="0.10" Margin="-40,-10,0,0">
                                        <Rectangle.Fill>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="#40FFFFFF" Offset="0" />
                                                <GradientStop Color="#00FFFFFF" Offset="0.55" />
                                                <GradientStop Color="#00FFFFFF" Offset="1" />
                                            </LinearGradientBrush>
                                        </Rectangle.Fill>
                                        <Rectangle.RenderTransform>
                                            <RotateTransform Angle="-12" CenterX="0.5" CenterY="0.5" />
                                        </Rectangle.RenderTransform>
                                    </Rectangle>

                                    <!-- Inner edge -->
                                    <Border CornerRadius="18"
                                            Margin="2"
                                            BorderThickness="1"
                                            BorderBrush="#26FFFFFF"
                                            IsHitTestVisible="False" />

                                    <!-- Content -->
                                    <ContentPresenter HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                </Grid>

                                <!-- Base shadow -->
                                <Border.Effect>
                                    <DropShadowEffect Color="#000000"
                                                      BlurRadius="20"
                                                      ShadowDepth="6"
                                                      Opacity="0.35" />
                                </Border.Effect>
                            </Border>
                        </Grid>

                        <ControlTemplate.Triggers>

                            <!-- Hover -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Glow" Property="Opacity" Value="1" />
                                <Setter TargetName="Root" Property="BorderBrush" Value="#80BDF8FF" />
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.04" ScaleY="1.04" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>

                            <!-- Press -->
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.97" ScaleY="0.97" />
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="Glow" Property="Opacity" Value="0.6" />
                            </Trigger>

                            <!-- Disabled -->
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>

                            <!-- READY: glow activo + borde -->
                            <DataTrigger Binding="{Binding IsReadyToPlay}" Value="True">
                                <Setter TargetName="Glow" Property="Opacity" Value="1" />
                                <Setter TargetName="Root" Property="BorderBrush" Value="#A0FFFFFF" />
                            </DataTrigger>

                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- PLAY style READY: contraste + micro pulso -->
        <Style x:Key="PlayButtonStyleReady"
       TargetType="Button"
       BasedOn="{StaticResource PlayButtonStyle}">

            <Style.Triggers>

                <!-- NOT READY -->
                <DataTrigger Binding="{Binding IsReadyToPlay}" Value="False">
                    <Setter Property="Opacity" Value="0.75"/>
                    <Setter Property="Background" Value="#2C4E87"/>
                </DataTrigger>

                <!-- READY (sin animación, solo contraste elegante) -->
                <DataTrigger Binding="{Binding IsReadyToPlay}" Value="True">
                    <Setter Property="Opacity" Value="1"/>
                    <Setter Property="Background" Value="#4FA3FF"/>
                </DataTrigger>

            </Style.Triggers>
        </Style>

        <!-- Barra de progreso fina tipo píldora (sin converters) + sheen animado -->
        <Style x:Key="ProgressPillStyle" TargetType="ProgressBar">
            <Setter Property="Height" Value="10" />
            <Setter Property="Background" Value="#0B162B" />
            <Setter Property="Foreground" Value="#38BDF8" />
            <Setter Property="BorderBrush" Value="#132443" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Grid x:Name="Root" ClipToBounds="True" SnapsToDevicePixels="True">

                            <!-- Track -->
                            <Border x:Name="PART_Track"
                                    CornerRadius="999"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Padding="1"
                                    ClipToBounds="True">
                                <Border x:Name="PART_Indicator"
                                        CornerRadius="999"
                                        HorizontalAlignment="Left"
                                        ClipToBounds="True">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="#6DE0FF" Offset="0" />
                                            <GradientStop Color="#38BDF8" Offset="0.45" />
                                            <GradientStop Color="#0EA5E9" Offset="1" />
                                        </LinearGradientBrush>
                                    </Border.Background>

                                    <Border BorderBrush="#96E9FF"
                                            BorderThickness="0,1,0,0"
                                            CornerRadius="999"
                                            Opacity="0.7" />
                                </Border>
                            </Border>

                            <!-- Sheen -->
                            <Rectangle x:Name="Sheen"
                                       IsHitTestVisible="False"
                                       Opacity="0.22"
                                       RadiusX="999"
                                       RadiusY="999"
                                       Margin="1">
                                <Rectangle.Fill>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#00FFFFFF" Offset="0" />
                                        <GradientStop Color="#80FFFFFF" Offset="0.5" />
                                        <GradientStop Color="#00FFFFFF" Offset="1" />
                                    </LinearGradientBrush>
                                </Rectangle.Fill>
                                <Rectangle.RenderTransform>
                                    <TranslateTransform x:Name="SheenTransform" X="-220" />
                                </Rectangle.RenderTransform>
                            </Rectangle>

                            <!-- Inner border -->
                            <Border CornerRadius="999"
                                    Margin="1"
                                    BorderThickness="1"
                                    BorderBrush="#1AFFFFFF"
                                    Opacity="0.25"
                                    IsHitTestVisible="False" />

                        </Grid>

                        <ControlTemplate.Triggers>

                            <!-- Animación sheen -->
                            <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation Storyboard.TargetName="SheenTransform"
                                                         Storyboard.TargetProperty="X"
                                                         From="-220"
                                                         To="520"
                                                         Duration="0:0:1.9" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>

                            <Trigger Property="IsIndeterminate" Value="True">
                                <Setter TargetName="Sheen" Property="Opacity" Value="0.32" />
                            </Trigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>

                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- NEWS styles -->
        <Style x:Key="NewsHeaderTitle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#D7E3FF" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontFamily" Value="Segoe UI Variable Text" />
        </Style>

        <Style x:Key="NewsCardTitle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#EAF2FF" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="12.5" />
            <Setter Property="FontFamily" Value="Segoe UI Variable Text" />
        </Style>

        <Style x:Key="NewsCardMeta" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#7FA0C9" />
            <Setter Property="FontSize" Value="10.5" />
            <Setter Property="FontFamily" Value="Segoe UI Variable Text" />
        </Style>

        <Style x:Key="NewsCardBody" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#90A4C3" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="FontFamily" Value="Segoe UI Variable Text" />
        </Style>

        <!-- ScrollBar theme -->
        <Style x:Key="NewsScrollBarThumb" TargetType="Thumb">
            <Setter Property="Height" Value="48" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border Background="#1B2C4E" CornerRadius="999" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="NewsScrollBarStyle" TargetType="ScrollBar">
            <Setter Property="Width" Value="8" />
            <Setter Property="Background" Value="#00000000" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Margin="2,0,2,0">
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource NewsScrollBarThumb}" />
                                </Track.Thumb>
                            </Track>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="PART_Track" Property="Opacity" Value="0.95" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="False">
                                <Setter TargetName="PART_Track" Property="Opacity" Value="0.75" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="NewsScrollViewerStyle" TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ScrollContentPresenter Grid.Column="0" />

                            <ScrollBar Grid.Column="1"
                                       Orientation="Vertical"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Style="{StaticResource NewsScrollBarStyle}" />
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SettingsScrollBarThumb" TargetType="Thumb">
            <Setter Property="Height" Value="56" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border x:Name="ThumbRoot"
                                Background="#1F2E52"
                                CornerRadius="999" />
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ThumbRoot" Property="Background" Value="#2D4B77" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SettingsScrollBarStyle" TargetType="ScrollBar">
            <Setter Property="Width" Value="10" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Border Background="#0B162B"
                                CornerRadius="999"
                                Margin="0,2,0,2">
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource SettingsScrollBarThumb}" />
                                </Track.Thumb>
                            </Track>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SettingsScrollViewerStyle" TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ScrollContentPresenter Grid.Column="0" />

                            <ScrollBar Grid.Column="1"
                                       Orientation="Vertical"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Style="{StaticResource SettingsScrollBarStyle}" />
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SettingsActionButton" TargetType="Button">
            <Setter Property="Height" Value="38" />
            <Setter Property="MinWidth" Value="196" />
            <Setter Property="Padding" Value="14,0" />
            <Setter Property="Background" Value="#132A3A" />
            <Setter Property="BorderBrush" Value="#1E4C70" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Foreground" Value="#DDEBFF" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                CornerRadius="9"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#2C7AB8" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Opacity" Value="0.88" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Storyboard x:Key="ShowSettingsModal">
            <DoubleAnimation Storyboard.TargetName="SettingsModal"
                             Storyboard.TargetProperty="Opacity"
                             From="0"
                             To="1"
                             Duration="0:0:0.15" />
            <DoubleAnimation Storyboard.TargetName="SettingsModalScale"
                             Storyboard.TargetProperty="ScaleX"
                             From="0.98"
                             To="1"
                             Duration="0:0:0.15" />
            <DoubleAnimation Storyboard.TargetName="SettingsModalScale"
                             Storyboard.TargetProperty="ScaleY"
                             From="0.98"
                             To="1"
                             Duration="0:0:0.15" />
        </Storyboard>

    </Window.Resources>

    <Window.Triggers>
        <EventTrigger RoutedEvent="Window.Loaded">
            <BeginStoryboard Storyboard="{StaticResource PortalBreath}" />
        </EventTrigger>
    </Window.Triggers>

    <Grid x:Name="Root">

        <Border x:Name="MainContent"
                Background="#0B1220"
                CornerRadius="18"
                Margin="12"
                Opacity="0">
            <Border.Effect>
                <BlurEffect x:Name="MainBlur" Radius="8" />
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="56" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Header container (rounded) -->
                <Border Grid.Row="0"
                        CornerRadius="16,16,0,0"
                        ClipToBounds="True"
                        Background="#111B2E"
                        MouseLeftButtonDown="Header_MouseLeftButtonDown">

                    <Grid Height="56" SnapsToDevicePixels="True">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Bottom subtle line -->
                        <Border VerticalAlignment="Bottom"
                                Height="1"
                                Opacity="0.55"
                                IsHitTestVisible="False">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#001C2E50" Offset="0" />
                                    <GradientStop Color="#402AA8FF" Offset="0.5" />
                                    <GradientStop Color="#001C2E50" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                        </Border>

                        <!-- Left: icon + title -->
                        <StackPanel Grid.Column="0"
                                    Orientation="Horizontal"
                                    Margin="16,8,0,0">

                            <Grid Width="42" Height="42" Margin="0,0,12,0">
                                <Ellipse Fill="#0E1A2F" />
                                <Ellipse Opacity="0.45">
                                    <Ellipse.Effect>
                                        <DropShadowEffect Color="#38BDF8"
                                                          BlurRadius="18"
                                                          ShadowDepth="0"
                                                          Opacity="0.35" />
                                    </Ellipse.Effect>
                                </Ellipse>

                                <Image Source="/Assets/icon.png"
                                       Width="78"
                                       Height="54"
                                       Stretch="Uniform"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Top"
                                       Margin="0,-3,0,0" />
                            </Grid>

                            <StackPanel Orientation="Vertical" Margin="0,2,0,0">

                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Style="{StaticResource HeaderTitleStyle}">
                                        <Run Text="Zaap" Foreground="#8FD3FF" />
                                        <Run Text=" Launcher" />
                                    </TextBlock>

                                    <!-- Version chip (outline) -->
                                    <Border CornerRadius="999"
                                            Padding="8,3"
                                            Margin="10,2,0,0"
                                            Background="#00000000"
                                            BorderBrush="#1F2E52"
                                            BorderThickness="1"
                                            Opacity="0.9">
                                        <TextBlock Text="{Binding LauncherVersion}"
                                                   Foreground="#BFD6FF"
                                                   FontSize="10.5"
                                                   FontWeight="SemiBold"
                                                   FontFamily="Segoe UI Variable" />
                                    </Border>
                                </StackPanel>

                                <TextBlock Text="Abriendo el portal al Mundo de los Doce…"
                                           Style="{StaticResource HeaderSubtitleStyle}"
                                           Margin="0,2,0,0" />
                            </StackPanel>
                        </StackPanel>

                        <!-- Right: status + actions -->
                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="0,0,14,0">

                            <!-- Status pill -->
                            <Border CornerRadius="999"
                                    Padding="12,7"
                                    Margin="0,0,8,0"
                                    BorderThickness="1"
                                    BorderBrush="#1F2E52">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                        <GradientStop Color="#0F1C34" Offset="0" />
                                        <GradientStop Color="#0B162B" Offset="1" />
                                    </LinearGradientBrush>
                                </Border.Background>

                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <Ellipse Width="8"
                                             Height="8"
                                             Margin="0,0,8,0"
                                             Fill="{Binding ServerStatusColor}" />
                                    <TextBlock Text="{Binding ServerStatusText}"
                                               Foreground="#D7E3FF"
                                               FontSize="12"
                                               FontWeight="SemiBold"
                                               FontFamily="Segoe UI Variable" />
                                </StackPanel>
                            </Border>

                            <Border Width="1"
                                    Height="20"
                                    Background="#1F2E52"
                                    Opacity="0.33"
                                    Margin="0,0,10,0" />

                            <Button Style="{StaticResource HeaderIconButton}"
                                    ToolTip="Ajustes"
                                    Click="OpenSettings_Click"
                                    Margin="0,0,10,0"
                                    FontSize="18">
                                <Image Source="/Assets/Icons/ajustes.png"
                                       Width="22"
                                       Height="22"
                                       Stretch="Uniform"
                                       SnapsToDevicePixels="True"
                                       RenderOptions.BitmapScalingMode="HighQuality" />
                            </Button>

                            <Border Width="1"
                                    Height="20"
                                    Background="#1F2E52"
                                    Opacity="0.33"
                                    Margin="0,0,10,0" />

                            <!-- Discord -->
                            <Button Style="{StaticResource HeaderIconButton}"
                                    ToolTip="Únete a Discord"
                                    Click="Discord_Click"
                                    Margin="0,0,8,0">
                                <Image Source="/Assets/Icons/discord.png"
                                       Width="22"
                                       Height="22"
                                       Stretch="Uniform"
                                       SnapsToDevicePixels="True"
                                       RenderOptions.BitmapScalingMode="HighQuality" />
                            </Button>

                            <!-- Minimize -->
                            <Button Style="{StaticResource HeaderIconButton}"
                                    ToolTip="Minimizar"
                                    Click="Minimize_Click"
                                    Margin="0,0,8,0">
                                <Image Source="/Assets/Icons/minimize.png"
                                       Width="18"
                                       Height="18"
                                       Stretch="Uniform"
                                       SnapsToDevicePixels="True"
                                       RenderOptions.BitmapScalingMode="HighQuality" />
                            </Button>

                            <!-- Close -->
                            <Button Style="{StaticResource HeaderCloseButton}"
                                    ToolTip="Cerrar"
                                    Click="Close_Click">
                                <Image Source="/Assets/Icons/close.png"
                                       Width="18"
                                       Height="18"
                                       Stretch="Uniform"
                                       SnapsToDevicePixels="True"
                                       RenderOptions.BitmapScalingMode="HighQuality" />
                            </Button>

                        </StackPanel>

                    </Grid>
                </Border>

                <!-- Body -->
                <Grid Grid.Row="1" Margin="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="340" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Left: News -->
                    <Border Background="#0E1A2F"
                            CornerRadius="16"
                            Padding="20,18,20,20"
                            Opacity="0.95"
                            Margin="-16,0,0,0">

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <TextBlock Text="Noticias" Style="{StaticResource NewsHeaderTitle}" />

                            <ScrollViewer Grid.Row="1"
                                          Margin="0,12,0,0"
                                          VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Disabled"
                                          Style="{StaticResource NewsScrollViewerStyle}">

                                <ItemsControl ItemsSource="{Binding NewsItems}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#0B162B"
                                                    CornerRadius="12"
                                                    Padding="12"
                                                    Margin="0,0,0,14"
                                                    BorderThickness="1"
                                                    BorderBrush="#132443">

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="72" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Image -->
                                                    <Border Grid.Column="0"
                                                            Width="64"
                                                            Height="64"
                                                            CornerRadius="12"
                                                            Background="#0E1A2F"
                                                            BorderThickness="1"
                                                            BorderBrush="#132443"
                                                            SnapsToDevicePixels="True"
                                                            VerticalAlignment="Top">
                                                        <Grid ClipToBounds="True">
                                                            <Image Source="{Binding ImageSource}"
                                                                   Stretch="UniformToFill"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"
                                                                   RenderOptions.BitmapScalingMode="HighQuality"
                                                                   SnapsToDevicePixels="True" />
                                                        </Grid>
                                                    </Border>

                                                    <Border Grid.Column="1"
                                                            Width="1"
                                                            Margin="4,2,10,2"
                                                            Background="#1F2E52"
                                                            Opacity="0.85"
                                                            VerticalAlignment="Stretch" />
                                                    
                                                    <!-- Content -->
                                                    <Grid Grid.Column="2">
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="Auto" />
                                                        </Grid.RowDefinitions>

                                                        <!-- Title + tag -->
                                                        <Grid Grid.Row="0" Margin="0,0,0,2">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>

                                                            <TextBlock Grid.Column="0"
                                                                       Text="{Binding Title}"
                                                                       Style="{StaticResource NewsCardTitle}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       Margin="0,0,10,0" />

                                                            <Border Grid.Column="1"
                                                                    CornerRadius="999"
                                                                    Padding="8,2"
                                                                    Background="#00000000"
                                                                    BorderThickness="1"
                                                                    BorderBrush="#1F2E52"
                                                                    Opacity="0.95"
                                                                    VerticalAlignment="Center">
                                                                <TextBlock Text="{Binding Tag}"
                                                                           Foreground="#BFD6FF"
                                                                           FontSize="10"
                                                                           FontWeight="SemiBold"
                                                                           FontFamily="Segoe UI Variable Text" />
                                                            </Border>
                                                        </Grid>

                                                        <!-- Date -->
                                                        <TextBlock Grid.Row="1"
                                                                   Text="{Binding DateText}"
                                                                   Style="{StaticResource NewsCardMeta}"
                                                                   Margin="0,0,0,6" />

                                                        <!-- Body -->
                                                        <TextBlock Grid.Row="2"
                                                                   Text="{Binding Body}"
                                                                   Style="{StaticResource NewsCardBody}" />

                                                        <!-- Link -->
                                                        <TextBlock Grid.Row="3"
                                                                   Text="Leer más →"
                                                                   Foreground="#8FD3FF"
                                                                   FontSize="11.5"
                                                                   Margin="0,8,0,0"
                                                                   Cursor="Hand"
                                                                   Visibility="{Binding HasLink}"
                                                                   MouseLeftButtonUp="NewsLink_Click" />
                                                    </Grid>

                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                            </ScrollViewer>
                        </Grid>
                    </Border>

                    <!-- Right -->
                    <Border Grid.Column="1"
                            Background="#0E1A2F"
                            CornerRadius="16"
                            Padding="16"
                            Margin="16,0,-16,0"
                            Opacity="0.90">

                        <Grid>
                            <!-- Portal area -->
                            <Grid HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Width="540"
                                  Height="420">

                                <!-- HALO GRANDE -->
                                <Ellipse Width="520"
                                         Height="520"
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Top"
                                         Margin="0,-10,0,0"
                                         Opacity="0.18"
                                         IsHitTestVisible="False"
                                         RenderTransformOrigin="0.5,0.5"
                                         Panel.ZIndex="15">
                                    <Ellipse.RenderTransform>
                                        <ScaleTransform ScaleX="1" ScaleY="1" />
                                    </Ellipse.RenderTransform>

                                    <Ellipse.Fill>
                                        <RadialGradientBrush Center="0.5,0.5" RadiusX="0.55" RadiusY="0.55">
                                            <GradientStop Color="#4038BDF8" Offset="0" />
                                            <GradientStop Color="#0038BDF8" Offset="1" />
                                        </RadialGradientBrush>
                                    </Ellipse.Fill>

                                    <Ellipse.Triggers>
                                        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                            <BeginStoryboard>
                                                <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                     From="0.12"
                                                                     To="0.22"
                                                                     Duration="0:0:3.4" />
                                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                                     From="0.99"
                                                                     To="1.03"
                                                                     Duration="0:0:3.4" />
                                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                                     From="0.99"
                                                                     To="1.03"
                                                                     Duration="0:0:3.4" />
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Ellipse.Triggers>
                                </Ellipse>

                                <!-- HALO PEQUEÑO -->
                                <Ellipse Width="360"
                                         Height="340"
                                         HorizontalAlignment="Left"
                                         VerticalAlignment="Top"
                                         Margin="74,71,0,0"
                                         Opacity="0.45"
                                         IsHitTestVisible="False"
                                         RenderTransformOrigin="0.5,0.5"
                                         Panel.ZIndex="20">
                                    <Ellipse.RenderTransform>
                                        <ScaleTransform ScaleX="1" ScaleY="1" />
                                    </Ellipse.RenderTransform>

                                    <Ellipse.Fill>
                                        <RadialGradientBrush Center="0.5,0.5" RadiusX="0.55" RadiusY="0.55">
                                            <GradientStop Color="#8038BDF8" Offset="0" />
                                            <GradientStop Color="#0038BDF8" Offset="1" />
                                        </RadialGradientBrush>
                                    </Ellipse.Fill>

                                    <Ellipse.Triggers>
                                        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                            <BeginStoryboard>
                                                <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                     From="0.32"
                                                                     To="0.52"
                                                                     Duration="0:0:2.7" />
                                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                                     From="0.98"
                                                                     To="1.05"
                                                                     Duration="0:0:2.7" />
                                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                                     From="0.98"
                                                                     To="1.05"
                                                                     Duration="0:0:2.7" />
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Ellipse.Triggers>
                                </Ellipse>

                                <!-- Portal frame -->
                                <Border CornerRadius="18"
                                        ClipToBounds="True"
                                        Width="540"
                                        Height="360"
                                        Panel.ZIndex="10">
                                    <Grid>
                                        <Image x:Name="PortalBaseImage"
                                               Source="/Assets/portal.jpg"
                                               Stretch="UniformToFill"
                                               Opacity="0.88"
                                               Margin="-88,0,-52,0" />

                                        <Ellipse x:Name="VortexEllipse"
                                                 Width="299"
                                                 Height="284"
                                                 HorizontalAlignment="Left"
                                                 VerticalAlignment="Top"
                                                 Margin="106,76,0,0"
                                                 Opacity="0.26"
                                                 RenderOptions.BitmapScalingMode="Fant"
                                                 IsHitTestVisible="False">
                                            <Ellipse.RenderTransform>
                                                <RotateTransform Angle="0" CenterX="149.5" CenterY="142" />
                                            </Ellipse.RenderTransform>

                                            <Ellipse.Fill>
                                                <ImageBrush ImageSource="/Assets/vortex.png"
                                                            Stretch="Uniform"
                                                            AlignmentX="Center"
                                                            AlignmentY="Center" />
                                            </Ellipse.Fill>

                                            <Ellipse.Triggers>
                                                <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                                    <BeginStoryboard>
                                                        <Storyboard RepeatBehavior="Forever">
                                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                                             From="0"
                                                                             To="360"
                                                                             Duration="0:0:05" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                            </Ellipse.Triggers>

                                        </Ellipse>

                                        <!-- Perimeter edge fade -->
                                        <Grid IsHitTestVisible="False" Panel.ZIndex="60">

                                            <!-- Top -->
                                            <Rectangle VerticalAlignment="Top" Height="80">
                                                <Rectangle.Fill>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                        <GradientStop Color="#B30E1A2F" Offset="0" />
                                                        <GradientStop Color="#000E1A2F" Offset="1" />
                                                    </LinearGradientBrush>
                                                </Rectangle.Fill>
                                            </Rectangle>

                                            <!-- Bottom -->
                                            <Rectangle VerticalAlignment="Bottom" Height="90">
                                                <Rectangle.Fill>
                                                    <LinearGradientBrush StartPoint="0,1" EndPoint="0,0">
                                                        <GradientStop Color="#B30E1A2F" Offset="0" />
                                                        <GradientStop Color="#000E1A2F" Offset="1" />
                                                    </LinearGradientBrush>
                                                </Rectangle.Fill>
                                            </Rectangle>

                                            <!-- Left -->
                                            <Rectangle HorizontalAlignment="Left" Width="90">
                                                <Rectangle.Fill>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                        <GradientStop Color="#B30E1A2F" Offset="0" />
                                                        <GradientStop Color="#000E1A2F" Offset="1" />
                                                    </LinearGradientBrush>
                                                </Rectangle.Fill>
                                            </Rectangle>

                                            <!-- Right -->
                                            <Rectangle HorizontalAlignment="Right" Width="90">
                                                <Rectangle.Fill>
                                                    <LinearGradientBrush StartPoint="1,0" EndPoint="0,0">
                                                        <GradientStop Color="#B30E1A2F" Offset="0" />
                                                        <GradientStop Color="#000E1A2F" Offset="1" />
                                                    </LinearGradientBrush>
                                                </Rectangle.Fill>
                                            </Rectangle>

                                        </Grid>

                                        <!-- Bottom fade -->
                                        <Rectangle VerticalAlignment="Bottom" Height="140" IsHitTestVisible="False">
                                            <Rectangle.Fill>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <GradientStop Color="#00000000" Offset="0" />
                                                    <GradientStop Color="#0E1A2F" Offset="1" />
                                                </LinearGradientBrush>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                    </Grid>
                                </Border>

                                <!-- Dark circle -->
                                <Ellipse Margin="129,125,162,52"
                                         Opacity="1"
                                         Panel.ZIndex="30">
                                    <Ellipse.Fill>
                                        <RadialGradientBrush Center="0.5,0.5"
                                                             GradientOrigin="0.5,0.5"
                                                             RadiusX="0.60"
                                                             RadiusY="0.60">
                                            <GradientStop Color="#E60B1220" Offset="0" />
                                            <GradientStop Color="#800B1220" Offset="0.45" />
                                            <GradientStop Color="#000B1220" Offset="1" />
                                        </RadialGradientBrush>
                                    </Ellipse.Fill>
                                </Ellipse>

                                <!-- PLAY + PROGRESO + ESTADO -->
                                <Canvas Panel.ZIndex="45">

                                    <!-- HALO READY detrás del botón -->
                                    <Border x:Name="PlayReadyHalo"
                                            Canvas.Left="130"
                                            Canvas.Top="220"
                                            Width="245"
                                            Height="115"
                                            CornerRadius="999"
                                            Opacity="0"
                                            IsHitTestVisible="False"
                                            Panel.ZIndex="40">
                                        <Border.Background>
                                            <RadialGradientBrush>
                                                <GradientStop Color="#507CFFB2" Offset="0" />
                                                <GradientStop Color="#007CFFB2" Offset="1" />
                                            </RadialGradientBrush>
                                        </Border.Background>
                                        <Border.Effect>
                                            <BlurEffect Radius="24" />
                                        </Border.Effect>

                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Opacity" Value="0" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsReadyToPlay}" Value="True">
                                                        <Setter Property="Opacity" Value="1" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                    </Border>

                                    <!-- PLAY -->
                                    <Button x:Name="PlayButton"
                                            Panel.ZIndex="45"
                                            Style="{StaticResource PlayButtonStyleReady}"
                                            IsEnabled="{Binding IsReadyToPlay}"
                                            Command="{Binding PlayCommand}"
                                            Canvas.Left="158"
                                            Canvas.Top="250"
                                            Height="54"
                                            Width="189">
                                        <TextBlock Text="PLAY" />
                                    </Button>

                                    <!-- HALO detrás de la barra -->
                                    <Ellipse Canvas.Left="1"
                                             Canvas.Top="353"
                                             Width="539"
                                             Height="25"
                                             Opacity="1"
                                             IsHitTestVisible="False"
                                             Panel.ZIndex="1"
                                             HorizontalAlignment="Left"
                                             VerticalAlignment="Center">
                                        <Ellipse.Fill>
                                            <RadialGradientBrush Center="0.5,0.5" RadiusX="0.60" RadiusY="0.55">
                                                <GradientStop Color="#8038BDF8" Offset="0" />
                                                <GradientStop Color="#0038BDF8" Offset="1" />
                                            </RadialGradientBrush>
                                        </Ellipse.Fill>
                                        <Ellipse.Effect>
                                            <BlurEffect Radius="18" />
                                        </Ellipse.Effect>
                                        <Ellipse.Triggers>
                                            <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                         From="0.10"
                                                                         To="0.20"
                                                                         Duration="0:0:2.8" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </Ellipse.Triggers>
                                    </Ellipse>

                                    <!-- Soft glow horizontal detrás de la barra -->
                                    <Rectangle Canvas.Left="-21"
                                               Canvas.Top="346"
                                               Width="582"
                                               Height="37"
                                               RadiusX="20"
                                               RadiusY="20"
                                               Opacity="0.18"
                                               IsHitTestVisible="False"
                                               Panel.ZIndex="1"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Top">
                                        <Rectangle.Fill>
                                            <RadialGradientBrush Center="0.5,0.5"
                                                                 RadiusX="0.9"
                                                                 RadiusY="0.5">
                                                <GradientStop Color="#8038BDF8" Offset="0" />
                                                <GradientStop Color="#0038BDF8" Offset="1" />
                                            </RadialGradientBrush>
                                        </Rectangle.Fill>
                                        <Rectangle.Effect>
                                            <BlurEffect Radius="18" />
                                        </Rectangle.Effect>
                                    </Rectangle>

                                    <ProgressBar x:Name="ProgressBarMain"
                                                 Canvas.Top="353"
                                                 Width="540"
                                                 Minimum="0"
                                                 Maximum="100"
                                                 Value="{Binding PatchProgress, Mode=OneWay}"
                                                 Panel.ZIndex="2"
                                                 HorizontalAlignment="Center"
                                                 VerticalAlignment="Center"
                                                 Height="22"
                                                 RenderTransformOrigin="0.5,0.5">
                                        <ProgressBar.RenderTransform>
                                            <TransformGroup>
                                                <ScaleTransform />
                                                <SkewTransform />
                                                <RotateTransform Angle="-0.008" />
                                                <TranslateTransform />
                                            </TransformGroup>
                                        </ProgressBar.RenderTransform>

                                        <ProgressBar.Style>
                                            <Style TargetType="ProgressBar" BasedOn="{StaticResource ProgressPillStyle}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsReadyToPlay}" Value="True">
                                                        <Setter Property="Opacity" Value="0.55" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ProgressBar.Style>
                                    </ProgressBar>

                                    <TextBlock Text="{Binding PatchProgress, StringFormat={}{0:0}%}"
                                               Canvas.Left="-18"
                                               Canvas.Top="383"
                                               Width="540"
                                               TextAlignment="Center"
                                               FontSize="12"
                                               Foreground="#BFD6FF"
                                               Opacity="0.75"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />

                                    <TextBlock Text="{Binding StatusHeadline}"
                                               Canvas.Left="42"
                                               Canvas.Top="406"
                                               Width="420"
                                               TextAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="#EAF2FF"
                                               Opacity="0.95"
                                               TextWrapping="Wrap"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsReadyToPlay}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <TextBlock Text="Portal estabilizado. Listo para entrar."
                                               Canvas.Left="42"
                                               Canvas.Top="406"
                                               Width="420"
                                               TextAlignment="Center"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               Foreground="#EAF2FF"
                                               Opacity="0.95"
                                               TextWrapping="Wrap"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsReadyToPlay}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <TextBlock Text="{Binding StatusDetail}"
                                               Canvas.Left="42"
                                               Canvas.Top="431"
                                               Width="420"
                                               TextAlignment="Center"
                                               FontSize="11"
                                               Foreground="#9CB3D9"
                                               Opacity="0.9"
                                               TextWrapping="Wrap"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsReadyToPlay}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <TextBlock Text="Todo actualizado. Buen viaje, aventurero."
                                               Canvas.Left="42"
                                               Canvas.Top="431"
                                               Width="420"
                                               TextAlignment="Center"
                                               FontSize="11"
                                               Foreground="#9CB3D9"
                                               Opacity="0.9"
                                               TextWrapping="Wrap"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsReadyToPlay}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                </Canvas>

                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Border>

        <Grid x:Name="SettingsModal"
              Panel.ZIndex="950"
              Background="#C0101625"
              Visibility="Collapsed"
              Opacity="0">
            <Border Width="720"
                    MaxHeight="500"
                    Padding="22"
                    CornerRadius="16"
                    Background="#0A1324"
                    BorderBrush="#223459"
                    BorderThickness="1"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="SettingsModalScale"
                                    ScaleX="1"
                                    ScaleY="1" />
                </Border.RenderTransform>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Ajustes"
                                   Foreground="#EAF2FF"
                                   FontSize="24"
                                   FontWeight="SemiBold" />

                        <Button Grid.Column="1"
                                Style="{StaticResource HeaderIconButton}"
                                ToolTip="Cerrar"
                                Click="CloseSettings_Click">
                            <Image Source="/Assets/Icons/close.png"
                               Width="18"
                               Height="18"
                               Stretch="Uniform"
                               SnapsToDevicePixels="True"
                               RenderOptions.BitmapScalingMode="HighQuality" />
                        </Button>
                    </Grid>

                    <ScrollViewer Grid.Row="1"
                                  Margin="0,18,0,0"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  Style="{StaticResource SettingsScrollViewerStyle}">
                        <StackPanel>
                            <Border Background="#3A2A12"
                                    CornerRadius="10"
                                    Padding="14"
                                    Margin="0,0,0,12"
                                    BorderBrush="#7C4F12"
                                    BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Margin="0,0,16,0">
                                        <TextBlock Text="Reparar"
                                                   Foreground="#EAF2FF"
                                                   FontSize="15"
                                                   FontWeight="SemiBold" />
                                        <TextBlock Text="Verifica archivos y repara daños del cliente."
                                                   Margin="0,5,0,0"
                                                   Foreground="#9CB3D9"
                                                   TextWrapping="Wrap" />
                                    </StackPanel>

                                    <Button Grid.Column="1"
                                            Style="{StaticResource SettingsActionButton}"
                                            Background="#3A2A12"
                                            BorderBrush="#7C4F12"
                                            Content="Iniciar reparación"
                                            Click="RunRepairFromModal_Click" />
                                </Grid>
                            </Border>

                            <Border Height="1"
                                    Margin="0,0,0,12"
                                    Background="#66132443" />

                            <Border Background="#132A3A"
                                    CornerRadius="10"
                                    Padding="14"
                                    Margin="0,0,0,12"
                                    BorderBrush="#1E4C70"
                                    BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Margin="0,0,16,0">
                                        <TextBlock Text="Carpeta del juego"
                                                   Foreground="#EAF2FF"
                                                   FontSize="15"
                                                   FontWeight="SemiBold" />
                                        <TextBlock Text="Abre la ruta donde está Dofus.exe para revisar archivos manualmente."
                                                   Margin="0,5,0,0"
                                                   Foreground="#9CB3D9"
                                                   TextWrapping="Wrap" />
                                    </StackPanel>

                                    <Button Grid.Column="1"
                                            Style="{StaticResource SettingsActionButton}"
                                            Background="#132A3A"
                                            BorderBrush="#1E4C70"
                                            Content="Abrir carpeta"
                                            Click="OpenGameFolder_Click" />
                                </Grid>
                            </Border>

                            <Border Height="1"
                                    Margin="0,0,0,12"
                                    Background="#66132443" />

                            <Border Background="#1B1F2B"
                                    CornerRadius="10"
                                    Padding="14"
                                    Margin="0,0,0,12"
                                    BorderBrush="#30384A"
                                    BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Margin="0,0,16,0">
                                        <TextBlock Text="Logs"
                                               Foreground="#EAF2FF"
                                               FontSize="15"
                                               FontWeight="SemiBold" />
                                        <TextBlock x:Name="LogsSummaryTextBlock"
                                               Margin="0,5,0,10"
                                               Foreground="#9CB3D9"
                                               TextWrapping="Wrap" />
                                    </StackPanel>

                                    <Button Grid.Column="1"
                                            Style="{StaticResource SettingsActionButton}"
                                            Background="#1B1F2B"
                                            BorderBrush="#30384A"
                                            Content="Abrir carpeta de logs"
                                            Click="OpenLogsFolder_Click" />
                                </Grid>
                            </Border>

                            <Border Height="1"
                                    Margin="0,0,0,12"
                                    Background="#66132443" />

                            <Border Background="#112C3C"
                                    CornerRadius="10"
                                    Padding="14"
                                    BorderBrush="#1E5C7A"
                                    BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Margin="0,0,16,0">
                                        <TextBlock Text="About"
                                                   Foreground="#EAF2FF"
                                                   FontSize="15"
                                                   FontWeight="SemiBold" />
                                        <TextBlock Text="Desarrollado por Shine para DutyFree Emulación. Dudas/sugerencias Shine#0005 - Github - DutyFree."
                                                   Margin="0,5,0,0"
                                                   Foreground="#9CB3D9"
                                                   TextWrapping="Wrap" />
                                    </StackPanel>

                                    <Button Grid.Column="1"
                                            Style="{StaticResource SettingsActionButton}"
                                            Background="#112C3C"
                                            BorderBrush="#1E5C7A"
                                            Content="Ir al Discord"
                                            Click="OpenCommunityDiscord_Click" />
                                </Grid>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <Grid x:Name="SplashOverlay"
              Panel.ZIndex="999"
              Background="#05070C"
              Opacity="1"
              Visibility="Visible"
              IsHitTestVisible="True"
              RenderTransformOrigin="0.5,0.5">
            <Grid.RenderTransform>
                <ScaleTransform x:Name="SplashScale"
                                ScaleX="1"
                                ScaleY="1" />
            </Grid.RenderTransform>

            <Grid.Triggers>
                <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                    <BeginStoryboard Storyboard="{StaticResource VortexLoop}" />
                </EventTrigger>
            </Grid.Triggers>

            <Grid x:Name="PortalHost"
                  Width="900"
                  Height="600"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center">
                <Image Source="/Assets/portal.jpg"
                       Stretch="Uniform"
                       RenderOptions.BitmapScalingMode="HighQuality" />

                <Grid x:Name="VortexLayer"
                      Width="386"
                      Height="360"
                      Opacity="0.25"
                      Panel.ZIndex="2"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      RenderTransformOrigin="0.5,0.5">

                    <Grid.Clip>
                        <EllipseGeometry Center="180,180" RadiusX="180" RadiusY="180" />
                    </Grid.Clip>

                    <Grid.OpacityMask>
                        <RadialGradientBrush>
                            <GradientStop Color="#FFFFFFFF" Offset="0.0" />
                            <GradientStop Color="#CCFFFFFF" Offset="0.55" />
                            <GradientStop Color="#00FFFFFF" Offset="1.0" />
                        </RadialGradientBrush>
                    </Grid.OpacityMask>

                    <Image x:Name="SplashVortex"
                           Source="/Assets/vortex.png"
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           RenderTransformOrigin="0.5,0.5"
                           Margin="0,1,-7,-54">
                        <Image.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform x:Name="SplashVortexScale" ScaleX="1.06" ScaleY="1.06" />
                                <RotateTransform x:Name="SplashVortexRotate" Angle="0" />
                            </TransformGroup>
                        </Image.RenderTransform>
                    </Image>
                </Grid>
            </Grid>

            <Rectangle Fill="#55050A16" />

            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Width="420" />
        </Grid>

    </Grid>
</Window>